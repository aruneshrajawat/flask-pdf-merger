{% extends "base.html" %}

{% block title %}PDF Merger - Download{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card glass text-center">
            <div class="card-header">
                <i class="fas fa-check-circle fa-3x mb-3" style="color: #28a745;"></i>
                <h3 class="mb-0">Merge Complete!</h3>
                <p class="mb-0 mt-2 opacity-75">Your PDF is ready for download</p>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <div class="floating">
                        <i class="fas fa-file-pdf fa-5x text-danger mb-3"></i>
                    </div>
                    <h4 class="fw-bold">{{ filename }}</h4>
                    <p class="text-muted">Successfully merged and optimized</p>
                </div>

                <div class="d-grid gap-3">
                    <a href="{{ url_for('download_file', filename=filename) }}" 
                       class="btn btn-success btn-lg">
                        DOWNLOAD PDF NOW
                    </a>
                    <div class="text-center">
                        <small>Your merged PDF is ready - Click above to download</small>
                    </div>
                    
                    <!-- Alternative download methods -->
                    <div class="text-center">
                        <small class="text-muted">Having trouble downloading? Try these options:</small><br>
                        <a href="{{ url_for('download_file', filename=filename) }}" class="btn btn-sm btn-outline-success me-2" download>
                            <i class="fas fa-download me-1"></i>Force Download
                        </a>
                        <button onclick="window.open('{{ url_for('download_file', filename=filename) }}', '_blank')" class="btn btn-sm btn-outline-info me-2">
                            <i class="fas fa-external-link-alt me-1"></i>Open in New Tab
                        </button>
                        <button onclick="window.location.href='{{ url_for('download_file', filename=filename) }}'" class="btn btn-sm btn-outline-warning">
                            <i class="fas fa-redo me-1"></i>Try Again
                        </button>
                    </div>
                    
                    <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                        <i class="fas fa-plus me-2"></i>Merge More Files
                    </a>
                </div>
                
                <!-- Debug info -->
                <div class="mt-3 p-2 bg-light rounded" style="font-size: 0.8rem;">
                    <strong>Debug Info:</strong><br>
                    Filename: {{ filename }}<br>
                    Download URL: {{ url_for('download_file', filename=filename) }}<br>
                    Pages: {{ pages }}<br>
                    Size: {{ size }}<br>
                    <div class="mt-2">
                        <a href="{{ url_for('download_file', filename=filename) }}" class="btn btn-sm btn-outline-secondary me-1">
                            Test Download Link
                        </a>
                        <a href="{{ url_for('create_test_file') }}" class="btn btn-sm btn-outline-warning">
                            Create Test File
                        </a>
                    </div>
                </div>
                
                <script>
                function trackDownload(filename) {
                    console.log('Download requested for:', filename);
                    // Add any tracking or analytics here
                }
                </script>

                <div class="mt-4">
                    <small class="text-muted">
                        File will be automatically deleted after 24 hours for security.
                    </small>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">File Details</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <strong>Filename:</strong><br>
                        <small>{{ filename }}</small>
                    </div>
                    <div class="col-6">
                        <strong>Size:</strong><br>
                        <small>{{ size if size else 'Unknown' }}</small>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-6">
                        <strong>Pages:</strong><br>
                        <small>{{ pages if pages else 'Unknown' }} pages</small>
                    </div>
                    <div class="col-6">
                        <strong>Created:</strong><br>
                        <small>Just now</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}